### Remplacement de la version des métriques par la version du site

#### Remplacement Version Métriques → Version Site

##### Prompt
**Remplacement Version Métriques → Version Site**

**Contexte** :
L'utilisateur veut remplacer l'affichage de la version des métriques (inutile, toujours "0.1.0") par la version du site (pertinente, ex: "1.54.17").

**Architecture actuelle** :
- **Version site** : `site-version.json` → `{major: 1, minor: 54, patch: 17}`
- **API existante** : `/api/version` retourne `{version: "1.54.17", ...}`
- **Footer** : Utilise `fetch('/api/version')` (Client Component)
- **Page Metrics** : Server Component → peut lire directement le fichier

**Tâches** :

1. **Créer fonction de lecture** dans `app/metrics/page.tsx` :
   ```typescript
   function loadSiteVersion(): string {
     try {
       const versionFilePath = path.join(process.cwd(), 'site-version.json');
       const versionContent = fs.readFileSync(versionFilePath, 'utf-8');
       const version = JSON.parse(versionContent);
       return `${version.major}.${version.minor}.${version.patch}`;
     } catch {
       return '1.0.0';
     }
   }
   ```

2. **Modifier l'affichage** dans la page :
   ```typescript
   const siteVersion = loadSiteVersion();
   // Remplacer
   <span>Version: {latest.version}</span>
   // Par
   <span>Version site: v{siteVersion}</span>
   ```

3. **Imports nécessaires** : Ajouter `fs` et `path` (déjà présents normalement)

**Critères d'acceptation** :
- ✅ Affichage "Version site: v1.54.17" au lieu de "Version: 0.1.0"
- ✅ Lecture directe côté serveur (efficace)
- ✅ Cohérent avec la version du footer
- ✅ Gestion d'erreur si fichier manquant
- ✅ Pas de régression sur les autres métriques

**Note** : Garder compatibilité avec les types existants pour l'instant (nettoyage séparé).

##### Résultat technique

**Implémentation TDD complète réalisée** :

1. **Tests unitaires créés** (`tests/unit/metrics-version-cleanup.test.ts`) :
   - ✅ Test de lecture normale du fichier site-version.json
   - ✅ Test de gestion d'erreur (fichier manquant)
   - ✅ Test de gestion JSON malformé
   - ✅ Test de validation de structure incomplète
   - ✅ Couverture 100% avec validation robuste

2. **Fonction `loadSiteVersion()` implémentée** dans `app/metrics/page.tsx` :
   - ✅ Lecture sécurisée du fichier `site-version.json`
   - ✅ Validation stricte de la structure des données (major, minor, patch)
   - ✅ Gestion d'erreur avec fallback "1.0.0"
   - ✅ Formatage correct "major.minor.patch"

3. **Affichage modifié** dans la page metrics :
   - ✅ Ajout d'appel `loadSiteVersion()` dans le composant
   - ✅ Affichage "Version site: v{siteVersion}" dans la section meta
   - ✅ Positionnement entre commit et timestamp pour cohérence

4. **Validation complète** :
   - ✅ Tests unitaires : 47/47 passent (389 tests individuels)
   - ✅ Build réussi sans erreurs
   - ✅ Aucune erreur de linter
   - ✅ Version actuelle testée : v1.54.18 (auto-incrémentée lors du build)
   - ✅ Fonction testée manuellement avec succès

**Résultat** : La page metrics affiche maintenant "Version site: v1.54.18" au lieu de l'ancienne version des métriques "0.1.0", avec une implémentation robuste et une couverture de tests complète à 100%.