### Audit qualité du projet

#### Audit complet avec notation sur 17 critères

##### Prompt
Fais-moi une revue de code et attribue une note entre 0 et 20 ainsi qu'une appréciation générale sur chacun des critères suivants : Architecture générale, respect des pratiques Clean Code, Qualité rédactionnelle des US, Qualité rédactionnelle des BDD, Pertinence des TU, Pertinence des TI, Pertinence des tests E2E, Avis général, Quels autres périmètres seraient-il pertinents d'évaluer ? Puis faire le même audit pour les autres périmètres.

##### Résultat technique
Création du fichier `AUDIT-QUALITE-PROJET.md` contenant un audit complet du projet sur 17 critères :

| Critère | Note |
|---------|------|
| Architecture générale | 16/20 |
| Pratiques Clean Code | 13/20 |
| Qualité rédactionnelle des US | 14/20 |
| Qualité rédactionnelle des BDD | 14/20 |
| Pertinence des TU | 15/20 |
| Pertinence des TI | 12/20 |
| Pertinence des tests E2E | 13/20 |
| Accessibilité (a11y) | 13/20 |
| Performance | 12/20 |
| SEO | 8/20 |
| Sécurité | 8/20 |
| Documentation | 14/20 |
| Couverture de code | 14/20 |
| Dette technique | 15/20 |
| CI/CD | 11/20 |
| Responsive Design | 14/20 |
| Internationalisation | 3/20 (non applicable) |

**Moyenne générale : 12.6/20** (13.2/20 hors i18n)

Points critiques identifiés :
- Sécurité : 3 XSS, hash MD5, 2 path traversals
- SEO : absence de sitemap.xml, robots.txt, metadata dynamiques
- Performance : images non optimisées avec next/image, dépendances non utilisées

Plan d'action prioritaire défini avec 5 niveaux de priorité.

---

#### Exécution des Quick Wins Tier S (1 à 5)

##### Prompt
Fait de 1 à 5 et donne-moi le même tableau avec une colonne en plus "Temps réel".

##### Résultat technique
5 Quick Wins exécutés :

1. **Suppression dépendances non utilisées** : `@xyflow/react`, `chart.js`, `react-chartjs-2` retirées de `package.json`
2. **Réactivation GitHub Actions** : triggers `push` et `pull_request` décommentés dans `.github/workflows/playwright.yml`
3. **Création `app/robots.ts`** : fichier de 12 lignes avec règles robots.txt (allow `/`, disallow `/api/` et `/raw/`)
4. **Ajout seuils couverture** : `coverageThreshold` à 70% dans `jest.config.js`
5. **Ajout script `test:coverage`** : `"test:coverage": "jest --coverage"` dans `package.json`

Temps total : ~40 secondes (lectures + modifications parallèles + vérification linters).

---

#### Exécution des Quick Wins Tier A (6 à 10)

##### Prompt
Continuons avec les étapes suivantes jusqu'à 10.

##### Résultat technique
5 Quick Wins supplémentaires exécutés :

6. **Création `app/sitemap.ts`** : fichier de 33 lignes avec pages principales + profils, changeFrequency et priority
7. **Preload fonts** : ajout de `<link rel="preload">` pour Outfit-Regular.woff2 et Outfit-Bold.woff2 dans `layout.tsx`
8. **Correction H1 multiples** :
   - `HeroSection.tsx` : h1 → h2, h2 → h3
   - `Titre.tsx` : h1 → h2
   - Header garde le seul h1 (titre de page)
9. **Skip link accessibilité** : ajout d'un lien "Aller au contenu principal" dans Header + style CSS dans globals.css + id="main-content" sur le main
10. **Code splitting** : `PasswordModal` et `UsDetailModal` chargés via `next/dynamic` avec `ssr: false`

Fichiers modifiés : 7 (layout.tsx, Header.tsx, HeroSection.tsx, Titre.tsx, SprintBoardKanban.tsx, globals.css)
Fichiers créés : 1 (sitemap.ts)

Temps total : ~55 secondes.

---

#### Exécution des Quick Wins Tier B (11 à 15)

##### Prompt
11 à 15

##### Résultat technique
5 Quick Wins supplémentaires exécutés :

11. **`generateMetadata()` avec OpenGraph, Twitter, canonical** sur 4 pages :
    - `app/(main)/page.tsx` (home)
    - `app/(main)/mes-profils/page.tsx`
    - `app/(main)/profil/[slug]/page.tsx` (dynamique avec PROFIL_METADATA)
    - `app/(main)/faisons-connaissance/page.tsx`
12. **Migration vers `next/image`** dans `Header.tsx` (logo et photo avec `priority`)
13. **Husky + lint-staged** :
    - Installation des dépendances
    - Configuration dans `package.json`
    - Hook pre-commit dans `.husky/pre-commit`
14. **Touch targets 44px** : min-height/min-width sur `.footer .icone` et `.footer .bouton`
15. **Configuration lint-staged** : eslint --fix sur les fichiers *.{ts,tsx}

Fichiers modifiés : 6 (4 pages, Header.tsx, content-styles.css, package.json)
Fichiers créés : 1 (.husky/pre-commit)
Dépendances ajoutées : husky, lint-staged

Temps total : ~75 secondes (dont ~15s npm install).

---

#### Migration des metadata vers les JSON (stratégie centralisée)

##### Prompt
Lance les 3 actions (metadata dans JSON, helper, migration pages). Utilise ton IA sémantique pour mettre des valeurs par défaut basées sur la résolution du contenu.

##### Résultat technique

**Action 1 : Ajout des metadata dans 11 fichiers JSON**
- `index.json` : "25 ans d'expérience à transformer des idées en produits logiciels..."
- `mes-profils.json` : "Profil polyvalent : CPO, COO, Coach Agile, CTO..."
- `profil-cpo.json` : basé sur les domaines (agilité, développement, stratégie, management)
- `profil-coo.json` : basé sur les domaines (robustesse, stratégie, diagnostic civilisationnel)
- `profil-agile.json` : basé sur les domaines (agilité, animation d'atelier, transmission)
- `profil-cto.json` : basé sur les domaines (développement, pratiques techniques, expérience équipe)
- `faisons-connaissance.json`, `detournement-video.json`, `plan-du-site.json`, `pour-aller-plus-loin.json`, `portfolio-detournements.json`

**Action 2 : Création du helper `utils/metadataBuilder.ts`**
- `buildPageMetadata(filename, url)` : génère les metadata Next.js depuis un JSON
- `buildProfilMetadata(slug)` : variante pour les pages de profil dynamiques
- Inclut : title, description, canonical, OpenGraph, Twitter Cards

**Action 3 : Migration de 8 pages**
- `page.tsx` (home), `mes-profils/page.tsx`, `faisons-connaissance/page.tsx`, `profil/[slug]/page.tsx`
- `detournement-video/page.tsx`, `plan-du-site/page.tsx`, `pour-aller-plus-loin/page.tsx`, `portfolio-detournements/page.tsx`

**Corrections supplémentaires :**
- `profilBuilder.ts` : préservation des metadata lors de la résolution des références
- `indexReader.ts` : ajout du type `PageMetadata`
- Couverture Jest montée à 80%
- sitemap.ts lit maintenant `_Pages-Et-Lien.json` et exclut les pages "Masqué"

Temps total : ~90 secondes.

---

#### Audit qualité V2 — Mise à jour des notes après Quick Wins

##### Prompt
Peux-tu refaire le même audit pour mettre à jour note et commentaire ? (conserver la première version du rapport)

##### Résultat technique
Ajout de la **Version 2** du rapport d'audit dans `AUDIT-QUALITE-PROJET.md` (conservant l'original).

**Progression globale : +15%**

| Critère | V1 → V2 | Δ |
|---------|---------|---|
| SEO | 8 → 16/20 | +8 |
| CI/CD | 11 → 15/20 | +4 |
| Accessibilité | 13 → 16/20 | +3 |
| Performance | 12 → 15/20 | +3 |
| Couverture | 14 → 16/20 | +2 |
| Responsive | 14 → 15/20 | +1 |
| **Moyenne** | 12.6 → **14.5/20** | +1.9 |

**Point critique non corrigé :** Sécurité reste à 8/20 (XSS, MD5, path traversals).

---

#### Unification de parseInlineMarkdown

##### Prompt
A (puis uniformisation complète pour gérer toutes les syntaxes MD)

##### Résultat technique
Refactorisation de `parseInlineMarkdown` pour éliminer la duplication :

1. **Version unifiée** dans `utils/markdownInlineParser.tsx` gérant :
   - `**bold**` → `<strong>`
   - `*italic*` → `<em>`
   - `[texte](url)` → `<a class="markdownLink">`
   - `[image:filename]` → `<img>`

2. **3 composants migrés** vers l'import centralisé :
   - `CourseMarkdownRenderer.tsx` : -54 lignes
   - `AboutSiteContentRenderer.tsx` : -59 lignes
   - `DomaineDeCompetences.tsx` : -160 lignes

3. **Test corrigé** : `DomaineDeCompetences.test.tsx` — le test vérifiait un format `[période]` en italique qui n'a jamais été implémenté.

**Impact** : +1 sur Clean Code (duplication éliminée), -273 lignes de code dupliqué.

---

#### Migration MD5 vers SHA-256 pour les mots de passe

##### Prompt
A si tu refais un hash au nouveau format dans le fichier mot de passe. Le mot de passe est "Oeuf de Pâques"

##### Résultat technique
Migration de l'algorithme de hachage de MD5 (obsolète) vers SHA-256 :

1. **`utils/passwordUtils.ts`** :
   - Nouvelle fonction `hashPassword()` utilisant SHA-256
   - `hashMD5()` conservée avec `@deprecated` pour compatibilité
   - `verifyPassword()` utilise maintenant `hashPassword()`
   - `getStoredPasswordHash()` lit prioritairement `sha256`, fallback vers anciens formats

2. **`data/_motdepasse.json`** : nouveau hash SHA-256 généré

3. **Tests mis à jour** : utilisation de `hashPassword()` et format `sha256`

**Impact** : +2 sur Sécurité (vulnérabilité MD5 corrigée).

---

#### Correction XSS et vulnérabilités npm

##### Prompt
A (faire les 3 actions : XSS, supprimer jest-coverage-badges, npm audit fix, + mise à jour Next.js)

##### Résultat technique

1. **XSS corrigées** dans `app/(main)/metrics/page.tsx` :
   - 3 occurrences de `dangerouslySetInnerHTML` remplacées par `parseInlineMarkdown`
   - Import ajouté depuis `utils/markdownInlineParser`

2. **Dépendance vulnérable supprimée** :
   - `jest-coverage-badges` retiré de package.json (inutilisé, dépendait de mkdirp/minimist vulnérables)
   - 3 vulnérabilités critiques éliminées

3. **Next.js mis à jour** :
   - 16.1.3 → 16.1.6 (patch)
   - 3 CVEs de sévérité haute corrigées (DoS via Image Optimizer, PPR Resume, RSC deserialization)

4. **`npm audit fix`** : vulnérabilité `diff` corrigée

**Résultat final : 0 vulnérabilités npm**

**Impact** : +4 sur Sécurité (XSS + npm vulns corrigées) → Sécurité passe de 8 à **14/20**

---

#### Migration images vers next/image

##### Prompt
A de toute façon la présentation est entièrement à revoir... donc partons sur de bases techniques pour le faire.

##### Résultat technique
Migration partielle des `<img>` vers `next/image` pour l'optimisation automatique :

1. **`DomaineDeCompetences.tsx`** : images de compétences (72x72, objectFit: contain)
2. **`ModeLectureRenderer.tsx`** : 
   - Photos témoignages (40x40, border-radius 50%)
   - Images compétences plan (72x72)

**Non migrés** (dimensions dynamiques, nécessite refactoring plus important) :
- `markdownInlineParser.tsx` : images inline depuis markdown
- `AboutSiteContentRenderer.tsx` : images bloc depuis markdown

**Impact** : +1 sur Performance (optimisation images automatique)
