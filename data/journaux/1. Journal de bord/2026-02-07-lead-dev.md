### Revue US-13.1 â€” GO NEXT (Lead Dev prend la main)

#### Prompt
L'utilisateur a demandÃ© **GO NEXT** aprÃ¨s livraison TDD-front-end pour US-13.1 (Menu header remplaÃ§ant le logo). Le Lead Dev effectue la revue et rÃ©dige le rapport.

#### RÃ©sultat
- **Revue** : VÃ©rifications DoD, baby steps, tests unitaires (Header + Footer), steps BDD menu-header. Rapport dÃ©taillÃ© dans `.cursor/RAPPORT-revue-US-13.1-2026-02-07.md`.
- **Verdict** : **ValidÃ©** â€” US-13.1 livrable (backend rattrapage + front + tests verts). RÃ©serves : BDD menu-header non exÃ©cutables tant que les 413 steps manquants des autres features ne sont pas traitÃ©s ; warning mineur `priority` sur mock next/image dans Header.test.
- **Suite** : Option A â€” clÃ´turer l'US (done). Option B â€” au prochain GO NEXT, corriger le warning puis clÃ´turer.

---

### Revue BDD US-13.2 â€” GO NEXT (Lead Dev prend la main)

#### Prompt
L'utilisateur a demandÃ© **GO NEXT** aprÃ¨s livraison BDD pour US-13.2 (RÃ©organisation du menu A propos). Le Lead Dev effectue la revue des scÃ©narios BDD.

#### RÃ©sultat
- **Fichier** : `tests/bdd/reorganisation-menu-a-propos.feature` crÃ©Ã©, couverture CA1â€“CA4.
- **Corrections mineures** : (1) Step Â« Quand je clique sur "A propos" dans le menu du header Â» â€” suppression du texte entre parenthÃ¨ses pour matcher le step existant `je clique sur {string} dans le menu du header`. (2) Â« j'ouvre le menu de navigation (hamburger) Â» remplacÃ© par Â« je clique sur l'icÃ´ne hamburger Â» pour rÃ©utilisation du step existant.
- **Verdict** : **BDD validÃ©.** Ã‰tape passÃ©e Ã  **TDD-back-end**. US-EN-COURS et US en cours mis Ã  jour.
- **Suite** : Au prochain GO NEXT, le Lead Dev proposera le plan de tests baby steps pour TDD-back-end, demandera ta validation, puis dÃ©lÃ©guera Ã  @TDD-back-end.

---

### Revue TDD-back-end US-13.2 â€” GO NEXT (Lead Dev prend la main)

#### Prompt
L'utilisateur a demandÃ© **GO NEXT** aprÃ¨s livraison TDD-back-end pour US-13.2 (RÃ©organisation du menu A propos).

#### RÃ©sultat
- **Verdict** : **ValidÃ©.** Steps 2 Ã  5 rÃ©alisÃ©s : constante `ABOUT_SITE_DATA_DIR`, menuReader + sprintBoardReader, renommage dossier `data/A propos`, config footer + routes (`/a-propos`, `cmd-APropos`). Tests unitaires et intÃ©gration concernÃ©s passent.
- **Step 1 (redirection 301)** : restÃ© hors pÃ©rimÃ¨tre agent (pas de modification next.config). **Correction Lead Dev** : ajout dans `next.config.ts` des redirections `/a-propos` â†’ `/a-propos` et `/a-propos/:path*` â†’ `/a-propos/:path*` (301) ; suppression de lâ€™ancienne redirection `/a-propos` â†’ `/`.
- **Suite** : Ã‰tape passÃ©e Ã  **TDD-front-end**. DÃ©lÃ©gation Ã  prÃ©parer : migration route `app/(main)/a-propos` â†’ `app/(main)/a-propos`, dropdown header Â« A propos Â», page Mentions lÃ©gales, steps BDD.

---

### E2E parcours-complet-liens + plan du site Â« Pour aller plus loin Â»

#### Contexte
- Ã‰chec systÃ©matique Ã  lâ€™**Ã©tape 15** du test E2E (navigation plan-du-site â†’ /pour-aller-plus-loin) sur les 3 navigateurs.
- Cause identifiÃ©e : la page `/pour-aller-plus-loin` nâ€™apparaÃ®t pas sur le plan du site (exclusion volontaire : `dessiner: "Non"`, `zone: "Masquer"` dans `_Pages-Liens-Et-Menus.json`), donc le lien `e2eid-l707` nâ€™est jamais rendu.

#### Actions (retour en arriÃ¨re)
- **Choix mÃ©tier confirmÃ©** : lâ€™exclusion de Â« Pour aller plus loin Â» du plan du site reste volontaire. Remise des bonnes valeurs dans `data/_Pages-Liens-Et-Menus.json` : `dessiner: "Non"`, `zone: "Masquer"` pour `/pour-aller-plus-loin`.
- **RÃ©gÃ©nÃ©ration** : exÃ©cution de `scripts/update-site-map.ts` pour que `plan-du-site.json` soit rÃ©gÃ©nÃ©rÃ© sans cette page.

#### Assistance crÃ©ation de scÃ©nario
- Lâ€™assistant affichait encore Â« Plan du site â†’ Pour aller plus loin, je vous propose une expÃ©rience... Â» dans la liste des liens Ã  parcourir.
- **Explication** : dans `update-site-map.ts`, `detecterLiensInternes()` lit `plan-du-site.json` au **dÃ©but** du script, alors quâ€™`injecterPagesDansPlanDuSiteJson()` met Ã  jour ce fichier Ã  la **fin**. Un seul passage aprÃ¨s le revert gardait donc lâ€™ancienne liste (avec la page) pour la gÃ©nÃ©ration des liens dans `_Pages-Liens-Et-Menus.json`.
- **Solution** : relancer une **deuxiÃ¨me fois** `update-site-map` pour que les liens soient recalculÃ©s Ã  partir du `plan-du-site.json` dÃ©jÃ  mis Ã  jour.
- **RÃ©sultat** : le lien `plan-du-site â†’ pour-aller-plus-loin` a Ã©tÃ© supprimÃ© de `_Pages-Liens-Et-Menus.json` (65 liens au lieu de 66). Lâ€™assistance de crÃ©ation de scÃ©nario ne propose plus cette Ã©tape. Pas besoin de TI dÃ©diÃ© : en cas de changement sur ce qui est affichÃ© sur le plan du site, relancer une fois `update-site-map` suffit pour resynchroniser plan, liens et menus.

---

### ClÃ´ture US-13.2 â€” RÃ©organisation du menu A propos

#### Prompt
Lâ€™utilisateur indique que **US-13.2 (RÃ©organisation du menu A propos)** est terminÃ©e. Pas de crÃ©ation dâ€™US pour les autres tÃ¢ches rÃ©alisÃ©es (double marge main / header, liens secondaires CTA, largeur des boutons hero). Mise Ã  jour du journal demandÃ©e.

#### RÃ©sultat
- **US-13.2** : MarquÃ©e **terminÃ©e** ; fichier renommÃ© en `US-13.2 - RÃ©organisation du menu A propos âœ… COMPLÃ‰TÃ‰.md`.
- **Journal** : entrÃ©e de clÃ´ture ajoutÃ©e (ci-dessus).
- **Autres rÃ©alisations** (sans US dÃ©diÃ©e) : suppression double marge (padding-top main-content-cont â†’ 0, padding sur .main-cont) ; style Â« bouton contour Â» pour liens secondaires (TÃ©lÃ©charger mon CV, En savoir plusâ€¦) ; mÃªme largeur des deux boutons hero + bouton secondaire moins haut.

---

### Refonte complÃ¨te de la stratÃ©gie E2E â€” Tests modulaires gÃ©nÃ©rÃ©s automatiquement

#### Contexte
L'ancien test E2E monolithique (`parcours-complet-liens.spec.ts`) souffrait de rÃ©gressions frÃ©quentes : scÃ©nario unique fragile, assistant de crÃ©ation de scÃ©nario complexe, incohÃ©rences entre logique mÃ©tier et gÃ©nÃ©ration de tests. DÃ©cision de tout remplacer par des tests modulaires gÃ©nÃ©rÃ©s automatiquement via un test d'intÃ©gration.

#### Architecture mise en place

**Nouveau TI gÃ©nÃ©rateur** : `tests/integration/generate-e2e-navigation.integration.test.ts`
- Lit les donnÃ©es via les fonctions mÃ©tier existantes : `detecterPages()`, `detecterLiensInternes()`, `readFooterButtons()`, `readHeaderMenu()`, `readMenu()`
- GÃ©nÃ¨re dynamiquement des fichiers `.spec.ts` Playwright dans `tests/end-to-end/`
- Chaque test : navigation â†’ clic sur lien (via e2eID) â†’ vÃ©rification URL destination â†’ `page.goBack()` â†’ vÃ©rification retour
- CohÃ©rence garantie : mÃªme logique mÃ©tier que l'application (ex. Â« menu masquÃ© Â» gÃ©rÃ© automatiquement)

**11 fichiers spec gÃ©nÃ©rÃ©s** :
- `page-home.spec.ts`, `page-mes-profils.spec.ts`, `page-plan-du-site.spec.ts`, `page-detournement-video.spec.ts`, `page-profil-cpo.spec.ts`, `page-profil-coo.spec.ts`, `page-profil-cto.spec.ts`, `page-profil-agile.spec.ts` â€” un par page avec ses liens sortants
- `footer.spec.ts` â€” boutons du footer (via `readFooterButtons()`)
- `menu-header.spec.ts` â€” menu principal et sous-menus (via `readHeaderMenu()`)
- `menu-a-propos.spec.ts` â€” menu spÃ©cifique de la page A propos (via `readMenu()`, 9 entrÃ©es)

---

### Nettoyage du code mort â€” Suppression de l'assistant de scÃ©nario E2E

#### Contexte
L'ancien systÃ¨me de crÃ©ation/gestion de scÃ©nario E2E (assistant graphique + builder + API) est devenu obsolÃ¨te avec la nouvelle architecture modulaire.

#### Fichiers supprimÃ©s
| CatÃ©gorie | Fichiers |
|---|---|
| Composant | `components/AssistantScenario.tsx` |
| Logique mÃ©tier | `utils/shared/assistantScenario.ts`, code e2eScenarioBuilder |
| Routes API | `app/api/generate-e2e-scenario/route.ts`, `app/api/site-map/validate/route.ts` |
| Scripts | `scripts/generate-e2e-scenario.ts`, `scripts/pre-commit-generate-e2e.ts` |
| Tests | `tests/unit/assistantScenario.test.ts`, `tests/unit/AssistantScenario.test.tsx`, `tests/unit/e2eScenarioBuilder.test.ts`, `tests/integration/generate-e2e-plan.integration.test.ts` |
| Test monolithique | `tests/end-to-end/parcours-complet-liens.spec.ts` |
| CSS mort | ~285 lignes de styles `.assistantScenario` dans `app/maintenance/maintenance.module.css` |
| Barrel exports | NettoyÃ©s dans `utils/client.ts`, `utils/shared/index.ts`, `utils/backoffice/index.ts` |
| package.json | Scripts `test:e2e:generate` et `precommit` retirÃ©s |

---

### Refonte du script de publication (`scripts/publie.ts`)

#### Modifications

**1. Nettoyage du cache `.next` avant vÃ©rification TypeScript**
- Nouvelle fonction `cleanNextCache()` : supprime le dossier `.next` pour Ã©viter les erreurs de types obsolÃ¨tes (ex. routes API supprimÃ©es encore rÃ©fÃ©rencÃ©es dans `.next/types/validator.ts`)
- RÃ©sout le problÃ¨me : `Cannot find module '../../app/api/generate-e2e-scenario/route.js'`

**2. Suppression de l'Ã©tape `generateE2EScenario()`**
- Appelait `npm run test:e2e:generate` (script supprimÃ©)
- La gÃ©nÃ©ration des fichiers E2E est dÃ©sormais intÃ©grÃ©e dans les tests d'intÃ©gration

**3. VÃ©rification de couverture en amont (fail fast)**
- Nouvelle Ã©tape 0 : `checkPreviousCoverage()` vÃ©rifie le `coverage-summary.json` du run prÃ©cÃ©dent
- Si la couverture est insuffisante, le pipeline s'arrÃªte immÃ©diatement (pas de nettoyage cache, ni TS check, ni tests)
- Seuils diffÃ©renciÃ©s : 80% pour lines/statements/functions, 65% pour branches (les branches conditionnelles JSX sont structurellement plus difficiles Ã  couvrir)

**4. Pipeline simplifiÃ©** (5 Ã©tapes au lieu de 6) :
- 0/4 : VÃ©rification couverture prÃ©cÃ©dente (fail fast)
- 1/4 : Nettoyage cache `.next` + vÃ©rification TypeScript
- 2/4 : Tests (inclut la gÃ©nÃ©ration E2E via le TI)
- 3/4 : Collecte des mÃ©triques
- 4/4 : Publication Git

---

### AmÃ©lioration de la couverture de tests â€” Passage de 79% Ã  83%

#### Contexte
La couverture de code Ã©tait Ã  79.45% (lines), sous le seuil de 80% requis par le script de publication.

#### Tests crÃ©Ã©s ou complÃ©tÃ©s

| Fichier | Tests ajoutÃ©s | Couverture avant â†’ aprÃ¨s |
|---|---|---|
| `tests/unit/e2eIdFromUrl.test.ts` | 11 (nouveau) | 52% â†’ ~100% |
| `tests/unit/e2eIdMapping.test.ts` | 42 (nouveau) | 53% â†’ ~85% |
| `tests/unit/journalMarkdownParser.test.ts` | 5 ajoutÃ©s | 78% â†’ 100% |
| `tests/unit/siteHierarchyGenerator.test.ts` | 7 ajoutÃ©s | 47% â†’ ~80% |

**DÃ©tails des tests ajoutÃ©s** :
- **e2eIdFromUrl** : `isInReservedRange` (plages 600-749, 800-949, hors plage), `generateE2eIdFromUrl` (dÃ©terminisme, normalisation, plages)
- **e2eIdMapping** : toutes les fonctions de construction de clÃ©s (`competenceKey`, `profilKey`, `footerKey`, etc.), `isExcluded`, `getE2eId`, `getE2eIdOrUndefined`, `generateE2eId` (tous prÃ©fixes), `loadMapping`/`saveMapping` (fichier rÃ©el avec backup/restore), `getOrCreateE2eId`
- **journalMarkdownParser** : deux parties consÃ©cutives, sous-partie avec contenu libre, changement de partie avec bloc en cours, retours Ã  la ligne Windows (\r\n)
- **siteHierarchyGenerator** : `buildHierarchyFromPageContenu`, `contenuToAsciiArt`, `renderContainersOnlyToAscii`

**Couverture globale rÃ©sultante** : lines 82.86%, statements 82.01%, functions 83.77%, branches 67.02%

---

### Adaptation du test de couverture e2eID (`e2e-ids-coverage.integration.test.ts`)

#### Contexte
Le test cherchait l'ancien fichier unique `parcours-complet-liens.spec.ts` pour vÃ©rifier la couverture des e2eID. Ce fichier n'existe plus.

#### Modifications
- Nouvelle fonction `extractE2eIdsFromAllSpecFiles()` : scanne tous les fichiers `*.spec.ts` du dossier `tests/end-to-end/`
- Le test vÃ©rifie qu'au moins des e2eID sont testÃ©s dans les specs existants
- Les e2eID manquants sont affichÃ©s en avertissement (informatif) plutÃ´t qu'en erreur bloquante, car la nouvelle architecture teste la navigation et non tous les e2eID du DOM

---

### Correction couverture Statements (retour au-dessus de 80%)

#### Contexte
La couverture Â« Statements Â» Ã©tait passÃ©e sous la barre des 80 %, et plusieurs tests Ã©taient en Ã©chec.

#### Corrections des tests en Ã©chec
- **headerMenuReader.test.ts** : Lorsque le menu contient Â« a-propos Â», `readMenu()` lit `menu.json` ; le mock renvoyait le plan (objet) au lieu dâ€™un tableau. Mock conditionnel selon le chemin (contenu tableau pour `menu.json`). Assertion URL corrigÃ©e : `/a-propos` au lieu de `/a-propos-du-site`.
- **Temoignages.test.tsx** : Classe CSS attendue alignÃ©e sur le composant : `listeDeTemoignages-cont` au lieu de `temoignages`.
- **generate-e2e-plan.integration.test.ts** : Le plan du site a un lien depuis `/` vers `/a-propos` (et non `/a-propos-du-site`) ; assertion mise Ã  jour.

#### Tests ajoutÃ©s pour repasser au-dessus de 80 %
- **headerMenuReader** : test Â« construit les URLs du sous-menu A propos (openapi, metrics, charte) Â» pour couvrir `getUrlForLigneAPropos` (lignes 23â€“26).
- **menuReader** : test Â« traite les lignes sans NumÃ©ro comme 0 pour le tri Â» (branche `?? 0`).
- **Footer** : mock des JSON `_footerButtons` et `_e2eIds-mapping` ; trois tests : retour `null` si donnÃ©es invalides, boutons invalides ignorÃ©s, `getFooterE2eId` utilisÃ© quand un bouton nâ€™a pas dâ€™e2eID.

**RÃ©sultat** : Statements 80 %, Footer.tsx 100 % statements. Branches restent lÃ©gÃ¨rement sous 65 %.

---

### CSS â€” Suppression double marge sous le header

#### Contexte
Un espace blanc sâ€™ajoutait au padding du `main` : double marge entre le header et le contenu.

#### RÃ©sultat technique
- **`.main-content-cont`** (layout) : `padding-top` passÃ© de `calc(var(--header-height) + 1rem)` Ã  **0** pour supprimer lâ€™espace blanc.
- **`.main-cont`** (pages) : rÃ¨gle par dÃ©faut dans `content-styles.css` : `padding-top: calc(var(--header-height) + 1rem)` pour une seule marge sous le header. Les pages a-propos / a-propos-du-site surchargent via leur CSS.

---

### CSS â€” Liens secondaires et boutons hero (mÃªme largeur, secondaire moins haut)

#### Contexte
Les liens Â« TÃ©lÃ©charger mon CV Â» et Â« En savoir plusâ€¦ Â» Ã©taient peu visibles par rapport au bouton Â« Discutons Â».

#### RÃ©sultat technique
- **Style Â« bouton contour Â»** pour les liens secondaires (hero, cartes profil, domaines de compÃ©tences) : bordure 2px bleue, fond transparent, survol bleu clair. SÃ©lecteurs : `.hero-cont .ui-heroCtas .lienInterne`, `.profil-cont .actions .lienInterne`, `.competence-cont.lienInterne`.
- **MÃªme largeur** : `.ui-heroCtas` en `align-items: stretch`, `width: 100%`, `max-width: 22rem` ; les deux boutons (CTA principal et lien secondaire) en `width: 100%`, `text-align: center`.
- **Bouton secondaire moins haut** : padding vertical `0.5rem` pour le lien secondaire du hero (police dÃ©jÃ  plus petite que le CTA).

---

### Sprint board â€” Post-it mock Â« Prendre un cafÃ© bien mÃ©ritÃ© â˜• Â»

#### Contexte
Lorsque toutes les US du sprint en cours sont terminÃ©es, le tableau doit afficher un post-it de type mock invitant Ã  Â« Prendre un cafÃ© Â».

#### RÃ©sultat technique
- **API** `app/api/sprint-board/route.ts` refactorisÃ©e :
  - DÃ©termination du sprint Ã  afficher : sprint de lâ€™US en cours (si une US est en cours et Ã©tape â‰  done), sinon dernier sprint.
  - AprÃ¨s chargement des donnÃ©es du board : si le sprint a au moins une carte et **toutes** les cartes sont en `state === 'fait'`, ajout de la carte fictive **US-9000.0 Â« Prendre un cafÃ© bien mÃ©ritÃ© â˜• Â»** en colonne Lead-dev (avec loupe ğŸ”) et mise Ã  jour du compteur.
  - Fonction dÃ©diÃ©e `addMockCafeIfAllDone(data)` pour centraliser la rÃ¨gle.
- Comportement : le post-it mock s'affiche dÃ¨s que toutes les US du sprint affichÃ© sont terminÃ©es, que le sprint vienne de Â« US en cours Â» ou du Â« dernier sprint Â».

---

### TI generate-e2e-navigation â€” Validation e2eID et correction des specs gÃ©nÃ©rÃ©s

#### Contexte
Le TI gÃ©nÃ¨re les fichiers `.spec.ts` Playwright dans `tests/end-to-end/` Ã  partir de `detecterPages()` et `detecterLiensInternes()`. Il fallait : (1) valider le format e2eID (lettre + chiffres) et, en cas d'invalide, faire exÃ©cuter par le TI lui-mÃªme le script ou le TU qui corrige/contrÃ´le les e2eID ; (2) corriger l'Ã©chappement des regex dans les specs gÃ©nÃ©rÃ©s.

#### Modifications

**1. Validation e2eID et lancement automatique du correcteur**
- Le TI filtre les liens testables (origine â‰  destination, e2eID non vide) et vÃ©rifie le format `^[a-zA-Z][0-9]+$`.
- Si au moins un e2eID est invalide : exÃ©cution de `npx tsx scripts/generate-e2e-mapping.ts` pour rÃ©gÃ©nÃ©rer le mapping, puis `clearMappingCache()` et relecture des liens. Si des invalides restent, exÃ©cution de `npx jest e2e-ids-detection --runInBand --no-cache` pour afficher le rapport dÃ©taillÃ©, puis le TI Ã©choue avec un message explicite.
- **`utils/shared/e2eIdMapping.ts`** : export de `clearMappingCache()` pour invalider le cache du mapping aprÃ¨s exÃ©cution du script dans un sous-processus (permettre la relecture du fichier mis Ã  jour).

**2. Specs gÃ©nÃ©rÃ©s**
- Correction des regex dans le code gÃ©nÃ©rÃ© : backslashes correctement Ã©chappÃ©s pour la chaÃ®ne JS dans le fichier `.ts` (ex. `new RegExp('\\/mes-profils(?:\\?.*)?$')`).
- Suppression du paramÃ¨tre inutilisÃ© `baseURL` dans `generateSpecContent`. Un fichier par page : `page-accueil.spec.ts`, `page-mes-profils.spec.ts`, etc., avec pour chaque lien sortant : `goto(source)` â†’ clic e2eID â†’ assertion URL destination â†’ `goBack()` â†’ assertion URL source.

---

### Fichier _Pages-Liens-Et-Menus.json absent â€” RÃ©silience et TU

#### Contexte
En naviguant sur le site, erreur runtime : Â« Fichier plan introuvable (_Pages-Liens-Et-Menus.json) Â» dans `utils/vitrine/headerMenuReader.ts` (appelÃ© depuis le layout).

#### Actions

**1. GÃ©nÃ©ration du fichier**
- ExÃ©cution de `npx ts-node --project tsconfig.node.json scripts/update-site-map.ts` pour crÃ©er `data/_Pages-Liens-Et-Menus.json` (14 pages, 45 liens) et mettre Ã  jour `plan-du-site.json`.

**2. Comportement de repli dans headerMenuReader**
- `readPlanFile()` : si le fichier n'existe pas, retour de `{ pages: [], menus: undefined }` au lieu de lancer une erreur. Le menu header utilise alors la configuration par dÃ©faut (Accueil, Mes profils, DÃ©tournement vidÃ©o, A propos) ; les titres restent les libellÃ©s par dÃ©faut ou l'URL.
- **Clarification** : le fichier est versionnÃ© (non listÃ© dans `.gitignore`) ; son absence est anormale (revert, branche sans le fichier, etc.). Le repli est une sÃ©curitÃ© pour ces cas rares.

**3. Mise Ã  jour du TU headerMenuReader**
- Ancien test : Â« lance une erreur quand aucun fichier plan n'existe Â» (attendait `toThrow(/introuvable|_Pages/i)`).
- Nouveau test : Â« retourne le menu header par dÃ©faut quand aucun fichier plan n'existe Â» â€” vÃ©rification que `readHeaderMenu()` retourne un tableau non vide avec au moins l'entrÃ©e `accueil` (plus d'erreur levÃ©e).

---

### Optimisation des performances Playwright â€” `defineBddConfig()` conditionnel

#### Contexte
Les tests E2E Ã©taient extrÃªmement lents : Playwright mettait plusieurs minutes juste pour charger la liste de 11 scÃ©narios (fichiers de 2 Ko en moyenne). MÃªme en mode UI, l'affichage Ã©tait bloquÃ©.

#### Diagnostic
**Le coupable** : `defineBddConfig()` de `playwright-bdd` Ã©tait appelÃ© au **top-level** de `playwright.config.ts`. Ã€ chaque chargement de Playwright (y compris mode UI, y compris pour lister les tests E2E), il :
1. Parsait **30 fichiers `.feature`**
2. Compilait **19 fichiers `.steps.ts`** (TypeScript)
3. Tentait de matcher **420 step definitions** manquantes
4. GÃ©nÃ©rait les specs dans `.features-gen/`

#### RÃ©sultat technique

**1. `defineBddConfig()` conditionnel** (`playwright.config.ts`)
- Import dynamique : `playwright-bdd` n'est chargÃ© (`require`) que quand nÃ©cessaire
- Variable `skipBddGen` : `true` si `SKIP_BDD_GEN=1` dans l'environnement OU si `process.argv` contient `tests/end-to-end`
- La gÃ©nÃ©ration BDD est dÃ©clenchÃ©e explicitement par `bddgen test` uniquement

**2. Scripts npm corrigÃ©s** (`package.json`)

| Script | Avant | AprÃ¨s |
|--------|-------|-------|
| `test:e2e` | `playwright test` | `playwright test tests/end-to-end` |
| `test:e2e:ui` | `playwright test --ui` | `playwright test tests/end-to-end --ui` |
| `test:e2e:headed` | *(manquant)* | `playwright test tests/end-to-end --headed` |
| `test:bdd` | `playwright test` | `playwright test .features-gen` |
| `test:bdd:ui` | `playwright test --ui` | `playwright test .features-gen --ui` |

**3. Chromium uniquement en local** (`playwright.config.ts`)
- En local : chromium seul (divise le temps par ~3)
- En CI (`process.env.CI`) : les 3 navigateurs (chromium + firefox + webkit) via spread conditionnel

**4. Timeout rÃ©duit**
- 300s (5 min) â†’ 60s (1 min) par test â€” largement suffisant pour un site de 10 pages

---

### Pipeline de publication â€” Erreurs BDD/E2E bloquantes

#### Contexte
Dans `scripts/collect-metrics-simple.ts`, les erreurs BDD Ã©taient traitÃ©es comme des **warnings** (`âš ï¸`) : le flag `hasError` Ã©tait positionnÃ© mais le script se terminait toujours avec code 0 (succÃ¨s). `publie.ts` ne dÃ©tectait donc jamais l'Ã©chec.

#### RÃ©sultat technique
- **BDD** : message `âŒ Ã‰chec des tests BDD â€” publication bloquÃ©e` ; `hasError = true`
- **E2E** : message `âŒ Ã‰chec des tests E2E â€” publication bloquÃ©e` ; `hasError = true`
- **Fin du script** : si `hasError === true`, `process.exit(1)` au lieu d'un warning. Cela fait remonter l'erreur Ã  `publie.ts` via `execSync` qui lance une exception, bloquant la publication Git.
- **Variable `SKIP_BDD_GEN`** : passÃ©e Ã  l'environnement lors de l'exÃ©cution E2E dans `collect-metrics-simple.ts` pour Ã©viter la gÃ©nÃ©ration BDD inutile.

---

### Refactoring BDD â€” Renommage Â« A propos du site Â» â†’ Â« A propos Â»

#### Contexte
Le dossier `data/A propos de ce site` avait Ã©tÃ© renommÃ© `data/A propos`, l'URL `/a-propos-du-site` remplacÃ©e par `/a-propos`, et la constante `ABOUT_SITE_DATA_DIR = 'A propos'` crÃ©Ã©e. Les fichiers BDD (`.feature` et `.steps.ts`) n'avaient pas Ã©tÃ© mis Ã  jour et rÃ©fÃ©renÃ§aient encore les anciens chemins et noms.

#### RÃ©sultat technique

**Fichiers `.feature` modifiÃ©s** (6 fichiers) :
- `a-propos-tableau-de-bord.feature` : Â« A propos de ce site Â» â†’ Â« A propos Â», chemins `data/A propos de ce site/` â†’ `data/A propos/`, URL `/a-propos-du-site` â†’ `/a-propos`
- `a-propos-board-kanban.feature` : idem
- `a-propos-modal-us.feature` : idem
- `charte-graphique-a-propos.feature` : idem + URL charte `/a-propos-du-site/charte` â†’ `/a-propos/charte`
- `reorganisation-menu-a-propos.feature` : idem + mise Ã  jour du contexte menu (Â« Definition Of Done Â» supprimÃ©, Â« A propos du projet Â» ajoutÃ©)
- `navigation-pages.feature` : URL `/a-propos-du-site` â†’ `/a-propos`

**Fichiers `.steps.ts` modifiÃ©s** (6 fichiers) :
- `a-propos-tableau-de-bord.steps.ts` : chemins en dur â†’ `ABOUT_SITE_DATA_DIR` ou `A propos`
- `a-propos-board-kanban.steps.ts` : idem
- `a-propos-modal-us.steps.ts` : idem
- `charte-graphique-a-propos.steps.ts` : idem + URL charte
- `reorganisation-menu-a-propos.steps.ts` : idem + assertions menu mises Ã  jour
- `navigation-pages.steps.ts` : URL `/a-propos-du-site` â†’ `/a-propos`

**Script corrigÃ©** :
- `scripts/sync-agents-json.ts` : chemin en dur â†’ utilisation de `ABOUT_SITE_DATA_DIR`

---

### Audit BDD â€” Dette technique des 420 step definitions manquantes

#### Contexte
L'utilisateur a constatÃ© que `bddgen test` signalait **420 missing step definitions** alors que les mÃ©triques affichaient Â« 251 BDD, 100% OK Â». L'explication : `missingSteps: 'fail-on-run'` dans la config faisait que `bddgen` gÃ©nÃ©rait les specs (exit code 0) mÃªme avec des steps manquants ; les tests manquants Ã©taient simplement absents des specs gÃ©nÃ©rÃ©es, donc jamais exÃ©cutÃ©s. Les 251 tests passaient, mais 420 contraintes Gherkin n'avaient **aucune step definition** les reliant Ã  du code de test.

#### Diagnostic dÃ©taillÃ©
- **30 fichiers `.feature`**, **19 fichiers `.steps.ts`**
- **11 features orphelines** : aucun fichier `.steps.ts` correspondant
- **Causes des mismatches identifiÃ©es** :
  1. **Variantes Â« que Â»** : le Gherkin franÃ§ais utilise `Et que` mais `playwright-bdd` strip le Â« que Â», laissant Â« Et Â». Des step definitions avaient le pattern avec Â« que Â» mais pas le matching sans.
  2. **ParenthÃ¨ses non Ã©chappÃ©es** : `bddgen` gÃ©nÃ¨re des patterns avec `\\(` (regex littÃ©rale) mais certaines step definitions utilisaient `(` (groupe de capture), causant un mismatch.
  3. **URLs littÃ©rales vs `{string}`** : certaines features utilisaient des URLs sans guillemets (`/a-propos`) lÃ  oÃ¹ les steps attendaient un paramÃ¨tre `{string}` (entre guillemets).
  4. **Steps vÃ©ritablement absents** : comportements dÃ©crits dans les features mais jamais implÃ©mentÃ©s en step definitions.

#### Plan d'action dÃ©fini
- **Phase 1** â€” Quick wins : features avec < 20 missing steps, corrections de pattern simples
- **Phase 2** â€” Features moyennes : `a-propos-tableau-de-bord` (35), `pages-profils-cibles` (25)
- **Phase 3** â€” Features lourdes : `assistant-scenario-maintenance` (66, supprimÃ©e), features complexes restantes
- **Suppression** : `assistant-scenario-maintenance.feature` (66 steps â€” code associÃ© dÃ©jÃ  supprimÃ©)

---

### Phase 1 â€” RÃ©duction des step definitions manquants de 420 Ã  285

#### Contexte
ExÃ©cution de la Phase 1 du plan d'action pour Ã©valuer le temps nÃ©cessaire et rÃ©duire la dette BDD. Objectif : traiter les features les plus faciles (< 20 missing steps).

#### Actions rÃ©alisÃ©es

**1. Suppression de `assistant-scenario-maintenance.feature`**
- Le composant `AssistantScenario.tsx` et tout le code associÃ© avaient dÃ©jÃ  Ã©tÃ© supprimÃ©s. La feature n'avait plus de raison d'exister.
- Impact : -66 steps manquants.

**2. CrÃ©ation de `markdown-heading-levels.steps.ts`** (18 steps)
- Couvre intÃ©gralement `markdown-heading-levels.feature` (dÃ©calage H1 MD â†’ H3 HTML, etc.)
- Utilise `parseSectionContent` et `validerContenuMarkdown` de `utils/projet/aboutSiteReader.ts`
- Steps crÃ©Ã©s : `Given` pour chaque niveau de titre (H1 Ã  H4, hiÃ©rarchie complÃ¨te), `When` pour le rendu et la validation, `Then` pour les assertions sur les niveaux HTML rÃ©sultants.

**3. `colonnes-board-agents-json.feature`** (17 steps) â€” **dÃ©jÃ  couvert**
- Tous les steps Ã©taient dÃ©jÃ  matchÃ©s par les dÃ©finitions partagÃ©es dans `a-propos-board-kanban.steps.ts`. Aucune action nÃ©cessaire.

**4. Correction typo dans `site-map.feature`**
- `data/__Pages-Liens-Et-Menus.json` (double underscore) â†’ `data/_Pages-Liens-Et-Menus.json` (simple underscore)
- Le nom de fichier dans le feature ne correspondait pas au fichier rÃ©el.

**5. Steps ajoutÃ©s dans des fichiers existants** (9 fichiers, 79 steps)

| Fichier | Steps ajoutÃ©s | Type de correction |
|---------|--------------|-------------------|
| `user-stories-format.steps.ts` | 1 | Alias sans Â« que Â» pour `Given('la section {string} est dÃ©roulÃ©e')` |
| `charte-graphique-a-propos.steps.ts` | 6 | Variantes sans Â« que Â» + URLs littÃ©rales (non guillemÃ©tÃ©es) |
| `plan-du-site-zones.steps.ts` | 8 | Variantes sans Â« que Â» + patterns multi-zones |
| `menu-header-remplacant-logo.steps.ts` | 8 | Variantes sans Â« que Â» + parenthÃ¨ses Ã©chappÃ©es |
| `reorganisation-menu-a-propos.steps.ts` | 9 | ParenthÃ¨ses Ã©chappÃ©es + paramÃ¨tres `{string}` |
| `tooltips-metriques.steps.ts` | 10 | Variantes sans Â« que Â» + parenthÃ¨ses Ã©chappÃ©es |
| `criteres-acceptation.steps.ts` | 12 | Variantes sans Â« qu' Â» + patterns H2/H4 |
| `a-propos-board-kanban.steps.ts` | 13 | Steps pour `indicateur-en-revue-board-kanban.feature` |
| `markdown-heading-levels.steps.ts` | 18 | Fichier entiÃ¨rement nouveau |

**6. VÃ©rification `bddgen test`**
- Configuration temporairement passÃ©e en `missingSteps: 'fail-on-gen'` pour obtenir le dÃ©compte prÃ©cis.
- RÃ©sultat : **285 missing step definitions** (contre 420 au dÃ©part, soit **-135, -32%**).

#### Features maintenant entiÃ¨rement couvertes (0 missing)
- `markdown-heading-levels.feature`
- `colonnes-board-agents-json.feature`
- `site-map.feature`
- `user-stories-format.feature`
- `charte-graphique-a-propos.feature`
- `plan-du-site-zones.feature`
- `menu-header-remplacant-logo.feature`
- `reorganisation-menu-a-propos.feature`
- `tooltips-metriques.feature`
- `criteres-acceptation.feature`
- `indicateur-en-revue-board-kanban.feature`

#### Restant Ã  traiter (Phase 2)
| Feature | Missing |
|---------|---------|
| `a-propos-tableau-de-bord` | 35 |
| `pages-profils-cibles` | 25 |
| `sprint-board-lecture-donnees` | 33 |
| `a-propos-board-kanban` | 28 |
| + autres features | ~164 |
| **Total** | **285** |
